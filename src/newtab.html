<!DOCTYPE html>
<html lang="ru">

<head>
    <meta charset="UTF-8">
    <title>MAUZER</title>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <style>
        *,
        *::before,
        *::after {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        html,
        body {
            height: 100%;
            overflow: hidden;
            font-family: 'Inter', sans-serif;
            background: #0a0a0a;
            color: rgba(255, 255, 255, 0.9);
            display: flex;
            align-items: center;
            justify-content: center;
            transition: background-color 0.35s cubic-bezier(0.4, 0, 0.2, 1), color 0.35s cubic-bezier(0.4, 0, 0.2, 1);
            user-select: none;
            -webkit-user-select: none;
            -ms-user-select: none;
        }

        [data-theme="light"] body,
        [data-theme="light"] html {
            background: #ffffff;
            color: rgba(0, 0, 0, 0.9);
        }

        /* Background glow */
        .glow {
            position: fixed;
            border-radius: 50%;
            filter: blur(140px);
            opacity: 0.04;
            pointer-events: none;
        }

        .glow-1 {
            top: -10%;
            left: 10%;
            width: 600px;
            height: 600px;
            background: #888;
        }

        .glow-2 {
            bottom: -10%;
            right: 10%;
            width: 600px;
            height: 600px;
            background: #aaa;
        }

        .container {
            display: flex;
            flex-direction: column;
            align-items: center;
            width: 100%;
            max-width: 800px;
            padding: 0 24px;
            position: relative;
            z-index: 1;
        }

        /* Local animated glow behind search and widgets */
        .local-glow-bg {
            position: absolute;
            top: 250px; /* Adjust based on logo height */
            left: 50%;
            transform: translateX(-50%);
            width: 800px;
            height: 400px;
            background: radial-gradient(circle, rgba(255,255,255,0.03) 0%, transparent 60%);
            z-index: -1;
            pointer-events: none;
            animation: pulse-glow 6s ease-in-out infinite;
            border-radius: 50%;
            filter: blur(20px);
        }

        @keyframes pulse-glow {
            0%, 100% { opacity: 0.4; transform: translateX(-50%) scale(0.95); }
            50% { opacity: 0.8; transform: translateX(-50%) scale(1.05); }
        }

        [data-theme="light"] .local-glow-bg {
            background: radial-gradient(circle, rgba(0,0,0,0.03) 0%, transparent 60%);
        }

        /* === LOGO === */
        .logo-block {
            display: flex;
            flex-direction: column;
            align-items: center;
            margin-bottom: 48px;
        }

        .logo {
            width: 420px;
            max-width: 80vw;
            height: auto;
            object-fit: contain;
            margin-bottom: 16px;
            filter: drop-shadow(0 0 40px rgba(255, 255, 255, 0.06));
        }



        /* === SEARCH === */
        .search-wrap {
            width: 100%;
            max-width: 700px;
            position: relative;
            margin-bottom: 56px;
            transition: transform 0.35s cubic-bezier(0.25, 0.8, 0.25, 1);
            z-index: 3;
        }

        .search-wrap:hover {
            transform: scale(1.02);
        }

        /* === WEATHER WIDGET === */
        .weather-widget {
            position: absolute;
            top: 16px;
            left: 24px;
            display: flex;
            flex-direction: column;
            gap: 10px;
            padding: 12px 14px;
            background: rgba(255, 255, 255, 0.08);
            border: 1px solid rgba(255, 255, 255, 0.1);
            border-radius: 14px;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.25);
            cursor: pointer;
            transform: translateY(0);
            transition: all 0.2s ease;
        }

        .weather-widget:hover {
            background: rgba(255, 255, 255, 0.12);
            border-color: rgba(255, 255, 255, 0.18);
            box-shadow: 0 12px 32px rgba(0, 0, 0, 0.25);
        }

        .weather-main {
            display: flex;
            align-items: flex-start;
            gap: 10px;
            width: 100%;
        }

        .weather-icon {
            width: 38px;
            height: 38px;
            object-fit: contain;
            filter: brightness(1.05) drop-shadow(0 2px 6px rgba(0,0,0,0.25));
            flex-shrink: 0;
        }

        .weather-info {
            display: flex;
            flex-direction: column;
            align-items: flex-start;
            gap: 2px;
        }

        .weather-temp {
            font-size: 18px;
            font-weight: 700;
            line-height: 1.1;
        }

        .weather-loc {
            font-size: 11px;
            color: rgba(255, 255, 255, 0.5);
            margin-top: 2px;
        }

        .weather-forecast {
            display: none;
            width: 100%;
            margin-top: 8px;
            padding-top: 8px;
            border-top: 1px solid rgba(255, 255, 255, 0.12);
            gap: 8px;
        }

        .forecast-item {
            display: flex;
            align-items: center;
            justify-content: space-between;
            gap: 10px;
            padding: 6px 8px;
            border-radius: 10px;
            background: rgba(255, 255, 255, 0.04);
        }

        .forecast-day {
            font-size: 12px;
            color: rgba(255, 255, 255, 0.75);
        }

        .forecast-meta {
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .forecast-icon {
            width: 22px;
            height: 22px;
            object-fit: contain;
            filter: brightness(1.05);
        }

        .forecast-temp {
            font-size: 13px;
            font-weight: 600;
        }

        .weather-widget.expanded {
            gap: 8px;
            width: 260px;
        }

        .weather-widget.expanded .weather-forecast {
            display: flex;
            flex-direction: column;
        }

        .weather-temp {
            font-size: 18px;
            font-weight: 600;
            line-height: 1.1;
        }

        .weather-loc {
            font-size: 11px;
            color: rgba(255, 255, 255, 0.5);
            margin-top: 2px;
        }

        [data-theme="light"] .weather-widget {
            background: rgba(0, 0, 0, 0.06);
            border-color: rgba(0, 0, 0, 0.12);
            box-shadow: 0 10px 26px rgba(0, 0, 0, 0.12);
        }
        [data-theme="light"] .weather-widget:hover {
            background: rgba(0, 0, 0, 0.1);
            border-color: rgba(0, 0, 0, 0.18);
        }
        [data-theme="light"] .weather-icon {
            filter: brightness(0.1) drop-shadow(0 2px 4px rgba(0,0,0,0.2));
        }
        [data-theme="light"] .weather-loc {
            color: rgba(0, 0, 0, 0.5);
        }
        [data-theme="light"] .weather-temp {
            color: rgba(0, 0, 0, 0.85);
        }
        [data-theme="light"] .forecast-item {
            background: rgba(0, 0, 0, 0.05);
        }
        [data-theme="light"] .forecast-day {
            color: rgba(0, 0, 0, 0.6);
        }
        [data-theme="light"] .forecast-temp {
            color: rgba(0, 0, 0, 0.85);
        }

        @keyframes fadeInDown {
            to { opacity: 1; transform: translateY(0); }
        }

        .search-bar {
            width: 100%;
            height: 56px;
            padding: 0 56px 0 24px;
            background: rgba(255, 255, 255, 0.05);
            border: 1px solid rgba(255, 255, 255, 0.08);
            border-radius: 28px;
            outline: none;
            color: #fff;
            font-size: 17px;
            font-family: inherit;
            transition: all 0.35s cubic-bezier(0.25, 0.8, 0.25, 1);
            box-shadow: 0 4px 24px rgba(0, 0, 0, 0.2);
            user-select: text;
            -webkit-user-select: text;
            -ms-user-select: text;
        }

        .search-bar:hover {
            border-color: rgba(255, 255, 255, 0.18);
            box-shadow: 0 4px 24px rgba(0, 0, 0, 0.2),
                0 0 15px rgba(255, 255, 255, 0.04),
                0 0 30px rgba(255, 255, 255, 0.02);
        }

        .search-bar:focus {
            background: rgba(255, 255, 255, 0.08);
            border-color: rgba(255, 255, 255, 0.25);
            box-shadow: 0 8px 40px rgba(0, 0, 0, 0.4),
                0 0 20px rgba(255, 255, 255, 0.06),
                0 0 40px rgba(255, 255, 255, 0.03);
        }

        /* Suggestions Styles */
        .suggestions {
            position: absolute;
            top: 100%;
            left: 0;
            right: 0;
            background: rgba(18, 18, 18, 0.97);
            border: 1px solid rgba(255, 255, 255, 0.12);
            border-top: none;
            border-radius: 0 0 28px 28px;
            padding: 8px 0;
            list-style: none;
            z-index: 100;
            box-shadow: 0 16px 40px rgba(0,0,0,0.5);
            max-height: 300px;
            overflow-y: auto;
            overflow-x: hidden;
            backdrop-filter: none;
            -ms-overflow-style: none; /* IE/Edge */
            scrollbar-width: none; /* Firefox */
            opacity: 0;
            visibility: hidden;
            pointer-events: none;
            transform: translateY(10px) scale(0.98);
            transition: opacity 240ms var(--ease), transform 260ms var(--ease), visibility 0s linear 260ms;
            will-change: opacity, transform;
        }

        .suggestions.show {
            opacity: 1;
            visibility: visible;
            pointer-events: auto;
            transform: translateY(0) scale(1);
            transition: opacity 240ms var(--ease), transform 260ms var(--ease), visibility 0s;
        }

        .suggestion-item {
            padding: 10px 20px;
            color: rgba(255, 255, 255, 0.9);
            cursor: pointer;
            font-size: 15px;
            display: flex;
            align-items: center;
            gap: 14px;
            transition: background 0.1s;
        }

        .suggestion-item:hover, .suggestion-item.selected {
            background: rgba(255, 255, 255, 0.1);
            color: #fff;
        }

        .suggestion-icon {
            width: 16px;
            height: 16px;
            opacity: 0.5;
            color: #fff;
            flex-shrink: 0;
        }

        .search-bar.has-suggestions {
            border-bottom-left-radius: 0;
            border-bottom-right-radius: 0;
            border-bottom-color: transparent;
            background: rgba(30, 30, 30, 0.98);
            box-shadow: none;
        }

        body.suggestions-open .search-bar,
        body.suggestions-open .suggestions {
            border-color: rgba(255, 255, 255, 0.18);
            box-shadow: 0 12px 48px rgba(0,0,0,0.45), 0 0 24px rgba(255,255,255,0.05);
            animation: suggest-glow 3s ease-in-out infinite;
        }

        @keyframes suggest-glow {
            0% { box-shadow: 0 12px 48px rgba(0,0,0,0.45), 0 0 18px rgba(255,255,255,0.03); }
            50% { box-shadow: 0 14px 56px rgba(0,0,0,0.5), 0 0 26px rgba(255,255,255,0.07); }
            100% { box-shadow: 0 12px 48px rgba(0,0,0,0.45), 0 0 18px rgba(255,255,255,0.03); }
        }

        body.suggestions-open .weather-widget,
        body.suggestions-open .quick-link,
        body.suggestions-open .quicklink-menu,
        body.suggestions-open .quicklink-menu-btn {
            pointer-events: none;
            opacity: 0.7;
        }

        /* Scrollbar for suggestions */
        .suggestions::-webkit-scrollbar {
            width: 0;
            height: 0;
        }

        /* Light Theme Suggestions */
        [data-theme="light"] .suggestions {
            background: rgba(255, 255, 255, 0.98);
            border-color: rgba(0, 0, 0, 0.1);
            color: #222;
        }
        [data-theme="light"] .suggestion-item {
            color: #333;
        }
        [data-theme="light"] .suggestion-item:hover, 
        [data-theme="light"] .suggestion-item.selected {
            background: rgba(0, 0, 0, 0.05);
        }
        [data-theme="light"] .suggestion-icon {
            color: #555;
        }
        [data-theme="light"] .search-bar.has-suggestions {
            background: #ffffff;
            border-bottom-color: transparent;
        }
        [data-theme="light"] .suggestions::-webkit-scrollbar-thumb {
            background: rgba(0, 0, 0, 0.2);
        }

        /* Animated neon sweep — single flash on hover */
        .search-wrap::before {
            content: '';
            position: absolute;
            top: -2px;
            left: -2px;
            right: -2px;
            bottom: -2px;
            border-radius: 30px;
            background: linear-gradient(90deg, transparent 0%, transparent 30%, rgba(255, 255, 255, 0.6) 50%, transparent 70%, transparent 100%);
            background-size: 200% 100%;
            background-position: -100% 0;
            opacity: 1;
            z-index: -1;
            /* Mask: only border ring visible */
            -webkit-mask: linear-gradient(#fff 0 0) content-box, linear-gradient(#fff 0 0);
            -webkit-mask-composite: xor;
            mask: linear-gradient(#fff 0 0) content-box, linear-gradient(#fff 0 0);
            mask-composite: exclude;
            padding: 2px;
            animation: neon-sweep 2.8s linear infinite;
        }

        @keyframes neon-sweep {
            0% { background-position: -100% 0; opacity: 0.4; }
            100% { background-position: 200% 0; opacity: 0.4; }
        }

        .search-bar::placeholder {
            color: rgba(255, 255, 255, 0.25);
        }

        .search-icon {
            position: absolute;
            right: 20px;
            top: 50%;
            transform: translateY(-50%);
            color: rgba(255, 255, 255, 0.3);
            pointer-events: none;
        }

        /* === QUICK LINKS === */
        .quick-links {
            display: grid;
            grid-template-columns: repeat(4, 1fr);
            gap: 20px;
            width: 100%;
            max-width: 700px;
        }

        .quick-link {
            position: relative;
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 10px;
            padding: 24px 12px 20px;
            border-radius: 16px;
            background: rgba(255, 255, 255, 0.03);
            border: 1px solid rgba(255, 255, 255, 0.04);
            cursor: pointer;
            text-decoration: none;
            transition: all 0.25s cubic-bezier(0.25, 0.8, 0.25, 1);
        }

        .quick-link:hover {
            background: rgba(255, 255, 255, 0.07);
            border-color: rgba(255, 255, 255, 0.1);
            transform: translateY(-4px);
            box-shadow: 0 12px 32px rgba(0, 0, 0, 0.35);
        }

        .quick-link-menu-btn {
            position: absolute;
            top: 6px;
            right: 6px;
            width: 22px;
            height: 22px;
            border-radius: 10px;
            border: 1px solid rgba(255, 255, 255, 0.08);
            background: rgba(12, 12, 12, 0.65);
            color: rgba(255, 255, 255, 0.75);
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 15px;
            line-height: 1;
            opacity: 0;
            transition: opacity 0.2s ease, background 0.2s ease, border-color 0.2s ease, transform 0.2s ease;
            cursor: pointer;
        }

        .quick-link:hover .quick-link-menu-btn {
            opacity: 1;
        }

        .quick-link-menu-btn:hover {
            background: rgba(20, 20, 20, 0.85);
            border-color: rgba(255, 255, 255, 0.2);
            transform: translateY(-1px);
        }

        .quicklink-menu {
            position: fixed;
            left: 0;
            top: 0;
            width: 140px;
            padding: 6px;
            background: rgba(18, 18, 18, 0.95);
            border: 1px solid rgba(255, 255, 255, 0.08);
            border-radius: 10px;
            box-shadow: 0 20px 60px rgba(0, 0, 0, 0.6);
            display: none;
            flex-direction: column;
            gap: 4px;
            z-index: 30;
        }

        .quicklink-menu.show {
            display: flex;
        }

        .quicklink-menu-item {
            height: 32px;
            padding: 0 10px;
            border-radius: 8px;
            background: transparent;
            border: none;
            color: rgba(255, 255, 255, 0.85);
            font-size: 12px;
            text-align: left;
            cursor: pointer;
            transition: background 0.15s ease, color 0.15s ease;
        }

        .quicklink-menu-item:hover {
            background: rgba(255, 255, 255, 0.08);
            color: #fff;
        }

        .quick-link-icon {
            width: 56px;
            height: 56px;
            border-radius: 14px;
            background: rgba(255, 255, 255, 0.06);
            display: flex;
            align-items: center;
            justify-content: center;
            overflow: hidden;
        }

        .quick-link-icon img {
            width: 36px;
            height: 36px;
            object-fit: contain;
            border-radius: 4px;
        }

        .quick-link-title {
            font-size: 12px;
            font-weight: 500;
            color: rgba(255, 255, 255, 0.6);
            text-align: center;
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
            max-width: 100%;
        }
        .quick-link-add {
            border-style: dashed;
            border-color: rgba(255, 255, 255, 0.2);
        }

        .quick-link-add .quick-link-icon {
            font-size: 28px;
            color: rgba(255, 255, 255, 0.6);
        }

        /* === LIGHT THEME === */
        [data-theme="light"] body,
        [data-theme="light"] {
            background: #ffffff;
            color: rgba(0, 0, 0, 0.86);
        }

        [data-theme="light"] .glow {
            display: none;
        }

        [data-theme="light"] .logo {
            filter: invert(1) drop-shadow(0 0 20px rgba(0, 0, 0, 0.05));
        }

        [data-theme="light"] .search-bar {
            background: #ffffff;
            border-color: rgba(0, 0, 0, 0.1);
            color: #222;
            box-shadow: 0 6px 24px rgba(0, 0, 0, 0.08);
        }

        [data-theme="light"] .search-bar:hover {
            border-color: rgba(0, 0, 0, 0.16);
            box-shadow: 0 8px 28px rgba(0, 0, 0, 0.1);
        }

        [data-theme="light"] .search-bar:focus {
            background: #ffffff;
            border-color: rgba(0, 0, 0, 0.2);
            box-shadow: 0 10px 36px rgba(0, 0, 0, 0.12);
        }

        [data-theme="light"] .search-bar::placeholder {
            color: rgba(0, 0, 0, 0.3);
        }

        [data-theme="light"] .search-icon {
            color: rgba(0, 0, 0, 0.3);
        }

        [data-theme="light"] .quick-link {
            background: #ececec;
            border-color: rgba(0, 0, 0, 0.12);
        }

        [data-theme="light"] .quick-link:hover {
            background: #e2e2e2;
            border-color: rgba(0, 0, 0, 0.16);
            box-shadow: 0 14px 34px rgba(0, 0, 0, 0.14);
        }

        [data-theme="light"] .quick-link-icon {
            background: rgba(0, 0, 0, 0.08);
        }

        [data-theme="light"] .quick-link-title {
            color: rgba(0, 0, 0, 0.7);
        }
        [data-theme="light"] .quick-link-menu-btn {
            background: rgba(255, 255, 255, 0.9);
            border-color: rgba(0, 0, 0, 0.12);
            color: rgba(0, 0, 0, 0.7);
        }
        [data-theme="light"] .quicklink-menu {
            background: rgba(245, 245, 245, 0.98);
            border-color: rgba(0, 0, 0, 0.08);
        }
        [data-theme="light"] .quicklink-menu-item {
            color: rgba(0, 0, 0, 0.8);
        }
        [data-theme="light"] .quicklink-menu-item:hover {
            background: rgba(0, 0, 0, 0.08);
            color: rgba(0, 0, 0, 0.9);
        }
        [data-theme="light"] .quick-link-add {
            border-color: rgba(0, 0, 0, 0.18);
        }

        [data-theme="light"] .quick-link-add .quick-link-icon {
            color: rgba(0, 0, 0, 0.75);
        }

        .modal {
            position: fixed;
            inset: 0;
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 10;
            opacity: 0;
            visibility: hidden;
            pointer-events: none;
            transition: opacity 0.25s ease, visibility 0.25s ease;
        }

        .modal.show {
            opacity: 1;
            visibility: visible;
            pointer-events: auto;
        }

        .modal-backdrop {
            position: absolute;
            inset: 0;
            background: rgba(0, 0, 0, 0.55);
            backdrop-filter: blur(6px);
            opacity: 0;
            transition: opacity 0.25s ease;
        }

        .modal-card {
            position: relative;
            width: min(92vw, 420px);
            background: rgba(20, 20, 20, 0.96);
            border: 1px solid rgba(255, 255, 255, 0.08);
            border-radius: 16px;
            padding: 18px;
            box-shadow: 0 20px 60px rgba(0, 0, 0, 0.5);
            opacity: 0;
            transform: translateY(8px) scale(0.98);
            transition: transform 0.25s ease, opacity 0.25s ease;
        }
        .modal.show .modal-card {
            opacity: 1;
            transform: translateY(0) scale(1);
        }
        .modal.show .modal-backdrop {
            opacity: 1;
        }

        .modal-title {
            font-size: 16px;
            font-weight: 600;
            margin-bottom: 12px;
        }

        .modal-field {
            display: flex;
            flex-direction: column;
            gap: 6px;
            margin-bottom: 12px;
        }

        .modal-label {
            font-size: 12px;
            color: rgba(255, 255, 255, 0.6);
        }

        .modal-input {
            height: 38px;
            border-radius: 10px;
            border: 1px solid rgba(255, 255, 255, 0.08);
            background: rgba(255, 255, 255, 0.04);
            color: rgba(255, 255, 255, 0.95);
            padding: 0 12px;
            outline: none;
        }

        .modal-input:focus {
            border-color: rgba(255, 255, 255, 0.2);
            background: rgba(255, 255, 255, 0.06);
        }

        .modal-actions {
            display: flex;
            gap: 10px;
            justify-content: flex-end;
            margin-top: 8px;
        }

        .modal-btn {
            height: 36px;
            border-radius: 10px;
            border: 1px solid rgba(255, 255, 255, 0.12);
            background: rgba(255, 255, 255, 0.08);
            color: rgba(255, 255, 255, 0.9);
            padding: 0 14px;
            cursor: pointer;
        }

        .modal-btn.ghost {
            background: transparent;
        }

        [data-theme="light"] .modal-backdrop {
            background: rgba(0, 0, 0, 0.35);
        }

        [data-theme="light"] .modal-card {
            background: rgba(245, 245, 245, 0.98);
            border-color: rgba(0, 0, 0, 0.08);
        }

        [data-theme="light"] .modal-label {
            color: rgba(0, 0, 0, 0.55);
        }

        [data-theme="light"] .modal-input {
            background: rgba(0, 0, 0, 0.04);
            border-color: rgba(0, 0, 0, 0.08);
            color: rgba(0, 0, 0, 0.9);
        }

        [data-theme="light"] .modal-btn {
            background: rgba(0, 0, 0, 0.06);
            border-color: rgba(0, 0, 0, 0.12);
            color: rgba(0, 0, 0, 0.8);
        }
    </style>
</head>

<body>
    <div class="glow glow-1"></div>
    <div class="glow glow-2"></div>

    <!-- Weather Widget -->
    <div id="weather-widget" class="weather-widget">
        <div class="weather-main">
            <img id="weather-icon" class="weather-icon" src="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 24 24' fill='none' stroke='%23fbbf24' stroke-width='2' stroke-linecap='round' stroke-linejoin='round'><circle cx='12' cy='12' r='5'/><path d='M12 1v2M12 21v2M4.22 4.22l1.42 1.42M18.36 18.36l1.42 1.42M1 12h2M21 12h2M4.22 19.78l1.42-1.42M18.36 5.64l1.42-1.42'/></svg>" alt="">
            <div class="weather-info">
                <span id="weather-temp" class="weather-temp">--°</span>
                <span id="weather-loc" class="weather-loc">Поиск...</span>
            </div>
        </div>
        <div class="weather-forecast" id="weather-forecast"></div>
    </div>

    <div class="container">
        <div class="logo-block">
            <img src="../MAUZER LOGO/main.png" class="logo" alt="Mauzer">
        </div>

        <div class="local-glow-bg"></div>

        <div class="search-wrap">
            <input type="text" class="search-bar" id="search-input" placeholder="Искать в интернете или ввести адрес"
                spellcheck="false" autocomplete="off" autofocus>
            <svg class="search-icon" width="22" height="22" viewBox="0 0 24 24" fill="none" stroke="currentColor"
                stroke-width="2" stroke-linecap="round">
                <circle cx="11" cy="11" r="8" />
                <line x1="21" y1="21" x2="16.65" y2="16.65" />
            </svg>
            <ul class="suggestions" id="suggestions"></ul>
        </div>

        <div class="quick-links" id="quick-links"></div>
        <div class="quicklink-menu" id="quicklink-menu">
            <button type="button" class="quicklink-menu-item" id="quicklink-delete">Удалить</button>
        </div>
    </div>

    <div class="modal" id="add-modal">
        <div class="modal-backdrop"></div>
        <div class="modal-card" role="dialog" aria-modal="true">
            <div class="modal-title">Добавить сайт</div>
            <div class="modal-field">
                <label class="modal-label" for="add-url">Ссылка</label>
                <input id="add-url" class="modal-input" type="text" placeholder="https://example.com" spellcheck="false" autocomplete="off">
            </div>
            <div class="modal-field">
                <label class="modal-label" for="add-title">Название</label>
                <input id="add-title" class="modal-input" type="text" placeholder="Example" spellcheck="false" autocomplete="off">
            </div>
            <div class="modal-actions">
                <button id="add-cancel" class="modal-btn ghost" type="button">Отмена</button>
                <button id="add-save" class="modal-btn" type="button">Добавить</button>
            </div>
        </div>
    </div>

    <script>
        const defaultLinks = [
            { url: 'https://www.youtube.com', title: 'YouTube' },
            { url: 'https://chatgpt.com', title: 'ChatGPT' },
        ];

        let quickLinks = [];
        let quicklinkMenuIndex = -1;
        const quicklinkMenu = document.getElementById('quicklink-menu');
        const quicklinkDelete = document.getElementById('quicklink-delete');
        const addModal = document.getElementById('add-modal');
        const addUrlInput = document.getElementById('add-url');
        const addTitleInput = document.getElementById('add-title');
        const addCancel = document.getElementById('add-cancel');
        const addSave = document.getElementById('add-save');

        const searchInput = document.getElementById('search-input');
        const suggestionsBox = document.getElementById('suggestions');
        let selectedIndex = -1;
        let debounceTimer;

        // Auto-focus on load
        window.addEventListener('load', () => {
            searchInput.focus();
            if (!window.mauzer) {
                console.error('Mauzer API missing in newtab');
                // Optional: try to indicate error visually
                // searchInput.style.borderColor = 'red';
            }
        });

        searchInput.addEventListener('input', (e) => {
            const val = e.target.value.trim();
            clearTimeout(debounceTimer);
            if (!val) {
                hideSuggestions();
                return;
            }
            
            debounceTimer = setTimeout(async () => {
                if (window.mauzer && window.mauzer.search) {
                    try {
                        const results = await window.mauzer.search.suggest(val);
                        renderSuggestions(results);
                    } catch (e) {
                        hideSuggestions();
                    }
                }
            }, 150);
        });

        // Если уже введен текст, при клике/фокусе сразу показать подсказки
        searchInput.addEventListener('focus', () => {
            if (searchInput.value.trim()) {
                searchInput.dispatchEvent(new Event('input'));
            }
        });

        searchInput.addEventListener('keydown', (e) => {
            const items = suggestionsBox.querySelectorAll('.suggestion-item');
            if (e.key === 'ArrowDown') {
                if (suggestionsBox.classList.contains('show')) {
                    e.preventDefault();
                    selectedIndex = Math.min(selectedIndex + 1, items.length - 1);
                    updateSelection(items);
                }
            } else if (e.key === 'ArrowUp') {
                if (suggestionsBox.classList.contains('show')) {
                    e.preventDefault();
                    selectedIndex = Math.max(selectedIndex - 1, -1);
                    updateSelection(items);
                }
            } else if (e.key === 'Enter') {
                if (selectedIndex >= 0 && items[selectedIndex]) {
                    e.preventDefault();
                    performSearch(items[selectedIndex].dataset.val);
                    hideSuggestions();
                } else {
                    // Default enter behavior handled by existing listener, just hide suggestions
                    hideSuggestions();
                }
            } else if (e.key === 'Escape') {
                hideSuggestions();
            }
        });

        function updateSelection(items) {
            items.forEach((item, i) => {
                item.classList.toggle('selected', i === selectedIndex);
                if (i === selectedIndex) {
                    searchInput.value = item.dataset.val;
                }
            });
        }

        function renderSuggestions(list) {
            if (!list || !list.length) {
                hideSuggestions();
                return;
            }
            
            suggestionsBox.innerHTML = list.map(text => `
                <li class="suggestion-item" data-val="${text.replace(/"/g, '&quot;')}">
                    <svg class="suggestion-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                        <circle cx="11" cy="11" r="8"></circle>
                        <line x1="21" y1="21" x2="16.65" y2="16.65"></line>
                    </svg>
                    <span>${text}</span>
                </li>
            `).join('');
            
            suggestionsBox.classList.add('show');
            searchInput.classList.add('has-suggestions');
            document.body.classList.add('suggestions-open');
            // Remove rounded corners from search bar wrapper too if needed, 
            // but search-bar class handles it.
            selectedIndex = -1;
        }

        function hideSuggestions() {
            suggestionsBox.classList.remove('show');
            searchInput.classList.remove('has-suggestions');
            document.body.classList.remove('suggestions-open');
            selectedIndex = -1;
        }

        function performSearch(val) {
            val = val.trim();
            if (!val) return;
            const isUrl = /^(https?:\/\/|[\w-]+\.[\w-]+)/.test(val);
            window.location.href = isUrl
                ? (val.startsWith('http') ? val : 'https://' + val)
                : 'https://www.google.com/search?q=' + encodeURIComponent(val);
        }

        document.addEventListener('click', (e) => {
            if (!searchInput.contains(e.target) && !suggestionsBox.contains(e.target)) {
                hideSuggestions();
            }
        });

        suggestionsBox.addEventListener('click', (e) => {
            const item = e.target.closest('.suggestion-item');
            if (item) {
                performSearch(item.dataset.val);
            }
        });

        function normalizeUrl(input) {
            const trimmed = input.trim();
            if (!trimmed) return null;
            if (trimmed.startsWith('http://') || trimmed.startsWith('https://')) return trimmed;
            return 'https://' + trimmed;
        }

        function filterBlocked(links) {
            const blocked = new Set(['telegram.org', 'www.telegram.org', 'google.com', 'www.google.com', 'reddit.com', 'www.reddit.com', 'twitter.com', 'www.twitter.com', 'x.com', 'www.x.com', 'github.com', 'www.github.com']);
            return links.filter(link => {
                try {
                    return !blocked.has(new URL(link.url).hostname);
                } catch (e) {
                    return true;
                }
            });
        }

        function renderLinks(links) {
            const container = document.getElementById('quick-links');
            container.innerHTML = '';
            links.forEach((link, index) => {
                const a = document.createElement('a');
                a.className = 'quick-link';
                a.href = link.url;
                a.setAttribute('draggable', 'true');
                a.dataset.index = String(index);
                const hostname = new URL(link.url).hostname;
                a.innerHTML = `
          <div class="quick-link-icon">
            <img src="https://www.google.com/s2/favicons?domain=${hostname}&sz=128" alt=""
              onerror="this.src='data:image/svg+xml,<svg xmlns=%22http://www.w3.org/2000/svg%22 viewBox=%220 0 24 24%22 fill=%22none%22 stroke=%22white%22 stroke-width=%222%22><circle cx=%2212%22 cy=%2212%22 r=%2210%22/></svg>'">
          </div>
          <span class="quick-link-title">${link.title}</span>
          <button class="quick-link-menu-btn" type="button">⋯</button>
        `;
                a.addEventListener('click', (e) => {
                    e.preventDefault();
                    window.location.href = link.url;
                });
                a.addEventListener('contextmenu', (e) => e.preventDefault());
                const menuBtn = a.querySelector('.quick-link-menu-btn');
                if (menuBtn) {
                    menuBtn.addEventListener('click', (e) => {
                        e.preventDefault();
                        e.stopPropagation();
                        showQuicklinkMenu(index, menuBtn);
                    });
                }
                a.addEventListener('dragstart', (e) => onDragStart(e, index));
                a.addEventListener('dragover', (e) => onDragOver(e, index));
                a.addEventListener('drop', (e) => onDrop(e, index));
                a.addEventListener('dragend', () => clearDragState());
                container.appendChild(a);
            });

            const add = document.createElement('button');
            add.type = 'button';
            add.className = 'quick-link quick-link-add';
            add.setAttribute('draggable', 'false');
            add.innerHTML = `
          <div class="quick-link-icon">+</div>
          <span class="quick-link-title">Добавить</span>
        `;
            add.addEventListener('click', () => {
                openAddModal();
            });
            container.appendChild(add);
        }

        async function loadLinks() {
            let links = defaultLinks;
            let saved = null;
            if (window.mauzer?.quicklinks?.get) {
                try {
                    saved = await window.mauzer.quicklinks.get();
                    if (Array.isArray(saved) && saved.length) links = saved;
                } catch (e) { }
            }
            const filtered = filterBlocked(links);
            quickLinks = filtered;
            if (saved && window.mauzer?.quicklinks?.save && filtered.length !== saved.length) {
                await window.mauzer.quicklinks.save(filtered);
            }
            renderLinks(quickLinks);
        }

        loadLinks();

        function showQuicklinkMenu(index, anchorEl) {
            quicklinkMenuIndex = index;
            const rect = anchorEl.getBoundingClientRect();
            quicklinkMenu.style.left = Math.max(12, rect.right - 140) + 'px';
            quicklinkMenu.style.top = rect.bottom + 6 + 'px';
            quicklinkMenu.classList.add('show');
        }

        function hideQuicklinkMenu() {
            quicklinkMenuIndex = -1;
            quicklinkMenu.classList.remove('show');
        }

        quicklinkDelete.addEventListener('click', async () => {
            if (quicklinkMenuIndex < 0) return;
            quickLinks = quickLinks.filter((_, i) => i !== quicklinkMenuIndex);
            if (window.mauzer?.quicklinks?.save) {
                await window.mauzer.quicklinks.save(quickLinks);
            }
            renderLinks(quickLinks);
            hideQuicklinkMenu();
        });

        document.addEventListener('click', (e) => {
            if (!quicklinkMenu.contains(e.target)) hideQuicklinkMenu();
        });

        let dragIndex = -1;
        function onDragStart(e, index) {
            dragIndex = index;
            e.dataTransfer.effectAllowed = 'move';
            e.dataTransfer.setData('text/plain', String(index));
        }
        function onDragOver(e, index) {
            if (index === dragIndex) return;
            e.preventDefault();
            e.dataTransfer.dropEffect = 'move';
        }
        async function onDrop(e, index) {
            e.preventDefault();
            if (dragIndex < 0 || dragIndex === index) return;
            const next = quickLinks.slice();
            const [moved] = next.splice(dragIndex, 1);
            next.splice(index, 0, moved);
            quickLinks = next;
            if (window.mauzer?.quicklinks?.save) {
                await window.mauzer.quicklinks.save(quickLinks);
            }
            renderLinks(quickLinks);
            clearDragState();
        }
        function clearDragState() {
            dragIndex = -1;
        }

        function openAddModal() {
            addUrlInput.value = '';
            addTitleInput.value = '';
            addModal.classList.add('show');
            setTimeout(() => addUrlInput.focus(), 0);
        }

        function closeAddModal() {
            addModal.classList.remove('show');
        }

        async function saveQuickLink() {
            const rawUrl = addUrlInput.value;
            const url = normalizeUrl(rawUrl);
            if (!url) {
                addUrlInput.focus();
                return;
            }
            let hostname = '';
            try { hostname = new URL(url).hostname; } catch (e) { }
            const title = (addTitleInput.value || hostname || url).trim();
            if (!title) return;
            quickLinks.push({ url, title });
            if (window.mauzer?.quicklinks?.save) {
                await window.mauzer.quicklinks.save(quickLinks);
            }
            renderLinks(quickLinks);
            closeAddModal();
        }

        addCancel.addEventListener('click', closeAddModal);
        addSave.addEventListener('click', saveQuickLink);
        addModal.addEventListener('click', (e) => {
            if (e.target === addModal || e.target.classList.contains('modal-backdrop')) closeAddModal();
        });
        addUrlInput.addEventListener('keydown', (e) => {
            if (e.key === 'Enter') saveQuickLink();
        });
        addTitleInput.addEventListener('keydown', (e) => {
            if (e.key === 'Enter') saveQuickLink();
        });
        document.addEventListener('keydown', (e) => {
            if (e.key === 'Escape' && addModal.classList.contains('show')) closeAddModal();
        });

        document.getElementById('search-input').addEventListener('keydown', (e) => {
            if (e.key === 'Enter') {
                const val = e.target.value.trim();
                if (!val) return;
                const isUrl = /^(https?:\/\/|[\w-]+\.[\w-]+)/.test(val);
                window.location.href = isUrl
                    ? (val.startsWith('http') ? val : 'https://' + val)
                    : 'https://www.google.com/search?q=' + encodeURIComponent(val);
            }
        });

        const searchWrap = document.querySelector('.search-wrap');
        if (searchWrap) {
            searchWrap.classList.remove('neon-flash');
        }

        // Apply theme (URL param has priority, otherwise take current settings and react to changes)
        const params = new URLSearchParams(window.location.search);
        const themeFromParam = params.get('theme');

        function applyTheme(theme) {
            const t = (theme || 'dark').toLowerCase();
            document.documentElement.setAttribute('data-theme', t);
            document.documentElement.style.colorScheme = t === 'light' ? 'light' : 'dark';
        }

        if (themeFromParam) {
            applyTheme(themeFromParam);
        } else if (window.mauzer?.settings?.load) {
            window.mauzer.settings.load().then(s => applyTheme(s?.theme || 'dark')).catch(() => {});
        }

        if (window.mauzer?.settings?.onChanged) {
            window.mauzer.settings.onChanged((s) => {
                applyTheme(s?.theme || 'dark');
            });
        }

        // === WEATHER LOGIC ===
        async function initWeather() {
            const widget = document.getElementById('weather-widget');
            const iconEl = document.getElementById('weather-icon');
            const tempEl = document.getElementById('weather-temp');
            const locEl = document.getElementById('weather-loc');
            const forecastEl = document.getElementById('weather-forecast');
            let expanded = false;

            widget.addEventListener('click', () => {
                expanded = !expanded;
                widget.classList.toggle('expanded', expanded);
            });

            try {
                // 1. Try ip-api.com (more reliable free tier, no HTTPS block usually)
                // Use http if https fails, but we are in file:// so we can fetch https
                let lat, lon, city;
                
                try {
                    const geoRes = await fetch('http://ip-api.com/json/?fields=status,message,lat,lon,city,regionName');
                    const geo = await geoRes.json();
                    if (geo.status !== 'success') throw new Error(geo.message || 'Geo failed');
                    lat = geo.lat;
                    lon = geo.lon;
                    city = geo.city || geo.regionName || 'Unknown';
                } catch (err1) {
                    console.warn('Primary geo failed, trying backup:', err1);
                    // Backup: ipapi.co
                    const geoRes2 = await fetch('https://ipapi.co/json/');
                    if (!geoRes2.ok) throw new Error('Backup geo failed');
                    const geo2 = await geoRes2.json();
                    lat = geo2.latitude;
                    lon = geo2.longitude;
                    city = geo2.city || geo2.region || 'Unknown';
                }

                // 2. Get weather from Open-Meteo
                const weatherRes = await fetch(`https://api.open-meteo.com/v1/forecast?latitude=${lat}&longitude=${lon}&current_weather=true&daily=temperature_2m_max,temperature_2m_min,weathercode&timezone=auto`);
                if (!weatherRes.ok) throw new Error('Weather failed');
                const weather = await weatherRes.json();
                
                const temp = Math.round(weather.current_weather.temperature);
                const code = weather.current_weather.weathercode;
                
                // Map WMO codes to icons
                // 0=Clear, 1-3=Cloudy, 45/48=Fog, 51-67=Drizzle/Rain, 71-77=Snow, 95-99=Thunderstorm
                let icon = 'sun';
                if (code > 0 && code <= 3) icon = 'cloud-sun';
                else if (code >= 45 && code <= 48) icon = 'fog';
                else if (code >= 51 && code <= 67) icon = 'rain';
                else if (code >= 71 && code <= 86) icon = 'snow';
                else if (code >= 95) icon = 'thunder';

                // Use simple SVG data URIs for icons
                const icons = {
                    'sun': 'data:image/svg+xml,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="%23fbbf24" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="5"/><path d="M12 1v2M12 21v2M4.22 4.22l1.42 1.42M18.36 18.36l1.42 1.42M1 12h2M21 12h2M4.22 19.78l1.42-1.42M18.36 5.64l1.42-1.42"/></svg>',
                    'cloud-sun': 'data:image/svg+xml,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="%23ffffff" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M12 2v2"/><path d="M12 20v2"/><path d="M4.93 4.93l1.41 1.41"/><path d="M17.66 17.66l1.41 1.41"/><path d="M2 12h2"/><path d="M20 12h2"/><path d="M6.34 17.66l-1.41 1.41"/><path d="M19.07 4.93l-1.41 1.41"/><path d="M12 12a5 5 0 1 0 0-10 5 5 0 0 0 0 10z"/><path d="M16 16a5 5 0 1 1-5 5"/></svg>',
                    'rain': 'data:image/svg+xml,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="%2360a5fa" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M16 16a5 5 0 1 1-5 5"/><path d="M12 12a5 5 0 1 0 0-10 5 5 0 0 0 0 10z"/><line x1="8" y1="19" x2="8" y2="21"/><line x1="8" y1="13" x2="8" y2="15"/><line x1="16" y1="19" x2="16" y2="21"/><line x1="16" y1="13" x2="16" y2="15"/><line x1="12" y1="21" x2="12" y2="23"/><line x1="12" y1="15" x2="12" y2="17"/></svg>',
                    'snow': 'data:image/svg+xml,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="%23ffffff" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M16 16a5 5 0 1 1-5 5"/><path d="M12 12a5 5 0 1 0 0-10 5 5 0 0 0 0 10z"/><line x1="8" y1="15" x2="8" y2="15.01"/><line x1="12" y1="18" x2="12" y2="18.01"/><line x1="16" y1="15" x2="16" y2="15.01"/></svg>',
                    'thunder': 'data:image/svg+xml,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="%23fbbf24" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M16 16a5 5 0 1 1-5 5"/><path d="M12 12a5 5 0 1 0 0-10 5 5 0 0 0 0 10z"/><path d="M13 19l-2 3h4l-2 3"/></svg>',
                    'fog': 'data:image/svg+xml,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="%239ca3af" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M5 12h14"/><path d="M5 16h14"/><path d="M5 20h14"/><path d="M5 8h14"/></svg>'
                };

                // Update UI current
                iconEl.src = icons[icon] || icons['sun'];
                tempEl.textContent = `${temp > 0 ? '+' : ''}${temp}°`;
                locEl.textContent = city;
                // widget.style.display = 'flex'; // Always visible now

                // Build forecast for next 2 days (tomorrow and day after)
                if (weather?.daily?.time && Array.isArray(weather.daily.time)) {
                    forecastEl.innerHTML = '';
                    const times = weather.daily.time;
                    const maxTemps = weather.daily.temperature_2m_max || [];
                    const minTemps = weather.daily.temperature_2m_min || [];
                    const codes = weather.daily.weathercode || [];

                    const todayIdx = times.findIndex(t => t === weather.current_weather.time?.split('T')[0]);
                    const items = [];
                    const labels = ['Завтра', 'Послезавтра', 'Через 3 дня'];
                    // offsets 1,2,3
                    [1, 2, 3].forEach((offset, idx) => {
                        const i = todayIdx >= 0 ? todayIdx + offset : offset; // fallback
                        if (times[i]) {
                            const dayLabel = labels[idx] || `+${offset} д.`;
                            const max = Math.round(maxTemps[i] ?? maxTemps[0] ?? temp);
                            const min = Math.round(minTemps[i] ?? minTemps[0] ?? temp);
                            const codeDay = codes[i] ?? code;
                            const iconKey = codeDay > 0 && codeDay <= 3 ? 'cloud-sun'
                                : (codeDay >= 45 && codeDay <= 48 ? 'fog'
                                : (codeDay >= 51 && codeDay <= 67 ? 'rain'
                                : (codeDay >= 71 && codeDay <= 86 ? 'snow'
                                : (codeDay >= 95 ? 'thunder' : 'sun'))));
                            const rawIcon = icons[iconKey] || icons.sun;
                            const safeIcon = rawIcon.replace(/"/g, '&quot;');
                            items.push({
                                day: dayLabel,
                                icon: safeIcon,
                                temp: `${max > 0 ? '+' : ''}${max}° / ${min > 0 ? '+' : ''}${min}°`
                            });
                        }
                    });

                    forecastEl.innerHTML = items.map(item => `
                        <div class="forecast-item">
                            <span class="forecast-day">${item.day}</span>
                            <div class="forecast-meta">
                                <img class="forecast-icon" src="${item.icon}" alt="" />
                                <span class="forecast-temp">${item.temp}</span>
                            </div>
                        </div>
                    `).join('');
                }

            } catch (e) {
                console.error('Weather error:', e);
                // widget.style.display = 'none'; // Don't hide on error
                locEl.textContent = 'Нет данных';
            }
        }

        initWeather();
    </script>
</body>

</html>
